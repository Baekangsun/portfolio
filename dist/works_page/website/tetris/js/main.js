const playground=document.querySelector(".playground > ul"),gameText=document.querySelector(".game-text"),scoreDisplay=document.querySelector(".score"),restartButton=document.querySelector(".game-text > button"),eazyLevel=document.querySelector(".level>.eazy"),normalLevel=document.querySelector(".level>.normal"),hardLevel=document.querySelector(".level>.hard"),GAME_ROWS=20,GAME_COLS=10;let downInterval,tempMovingItem,score=0,duration=500;const movingItem={type:"",direction:3,top:0,left:0},BLOCKS={tree:[[[1,0],[0,1],[1,1],[1,2]],[[2,1],[0,1],[1,1],[1,2]],[[2,1],[1,2],[1,1],[1,0]],[[1,0],[0,1],[1,1],[2,1]]],square:[[[0,0],[0,1],[1,0],[1,1]],[[0,0],[0,1],[1,0],[1,1]],[[0,0],[0,1],[1,0],[1,1]],[[0,0],[0,1],[1,0],[1,1]]],zeeLeft:[[[0,0],[1,0],[1,1],[2,1]],[[0,1],[1,0],[1,1],[0,2]],[[0,1],[1,1],[1,2],[2,2]],[[2,0],[2,1],[1,1],[1,2]]],zeeRight:[[[3,0],[2,1],[2,0],[1,1]],[[1,0],[1,1],[2,1],[2,2]],[[0,2],[1,1],[1,2],[2,1]],[[0,0],[0,1],[1,1],[1,2]]],bar:[[[1,0],[2,0],[3,0],[4,0]],[[2,-1],[2,0],[2,1],[2,2]],[[1,0],[2,0],[3,0],[4,0]],[[2,-1],[2,0],[2,1],[2,2]]],elLeft:[[[0,0],[0,1],[1,1],[2,1]],[[1,0],[1,1],[1,2],[0,2]],[[0,1],[1,1],[2,1],[2,2]],[[1,0],[2,0],[1,1],[1,2]]],elRight:[[[1,0],[2,0],[1,1],[1,2]],[[0,0],[0,1],[1,1],[2,1]],[[0,2],[1,0],[1,1],[1,2]],[[0,1],[1,1],[2,1],[2,2]]]};function blockSpeedLevel(e,t){e.addEventListener("click",(function(){clearInterval(downInterval),downInterval=setInterval((()=>{moveBlock("top",1)}),t)}))}function generateNewBlock(){clearInterval(downInterval),downInterval=setInterval((()=>{moveBlock("top",1)}),duration);const e=Object.entries(BLOCKS),t=Math.floor(Math.random()*e.length);movingItem.type=e[t][0],movingItem.top=0,movingItem.left=3,movingItem.direction=0,tempMovingItem={...movingItem},renderBlocks()}function init(){tempMovingItem={...movingItem};for(let e=0;e<20;e++)prependNewLine();generateNewBlock()}function prependNewLine(){const e=document.createElement("li"),t=document.createElement("ul");for(let e=0;e<10;e++){const e=document.createElement("li");t.prepend(e)}e.prepend(t),playground.prepend(e)}function renderBlocks(e=""){const{type:t,direction:o,top:n,left:r}=tempMovingItem;document.querySelectorAll(".moving").forEach((e=>{e.classList.remove(t,"moving")})),BLOCKS[t][o].some((o=>{const c=o[0]+r,l=o[1]+n,i=playground.childNodes[l]?playground.childNodes[l].childNodes[0].childNodes[c]:null;if(!checkEmpty(i))return tempMovingItem={...movingItem},"retry"===e&&(clearInterval(downInterval),showGameoverText()),setTimeout((()=>{renderBlocks("retry"),"top"===e&&seizeBlock()}),0),!0;i.classList.add(t,"moving")})),movingItem.left=r,movingItem.top=n,movingItem.direction=o}function checkEmpty(e){return!(!e||e.classList.contains("seized"))}function chageDirection(){3===tempMovingItem.direction?tempMovingItem.direction=0:tempMovingItem.direction+=1,renderBlocks()}function seizeBlock(){document.querySelectorAll(".moving").forEach((e=>{e.classList.remove("moving"),e.classList.add("seized")})),checkMatch()}function checkMatch(){playground.childNodes.forEach((e=>{let t=!0;e.children[0].childNodes.forEach((e=>{e.classList.contains("seized")||(t=!1)})),t&&(e.remove(),prependNewLine(),score++,scoreDisplay.innerHTML=score)})),generateNewBlock()}function moveBlock(e,t){tempMovingItem[e]+=t,renderBlocks(e)}function dropBlock(){clearInterval(downInterval),downInterval=setInterval((()=>{moveBlock("top",1)}),4)}function showGameoverText(){gameText.style.display="flex",score=0,scoreDisplay.innerHTML=0}blockSpeedLevel(eazyLevel,500),blockSpeedLevel(normalLevel,300),blockSpeedLevel(hardLevel,100),init(),document.addEventListener("keydown",(e=>{switch(e.keyCode){case 39:moveBlock("left",1);break;case 37:moveBlock("left",-1);break;case 40:moveBlock("top",1);break;case 38:chageDirection();break;case 32:dropBlock()}})),restartButton.addEventListener("click",(()=>{playground.innerHTML="",gameText.style.display="none",init()}));